<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Benchmarking Modular Mojo🔥 and PyTorch torch.compile() on Mandelbrot function | Shashank Prasanna</title><meta name=description content="Quick comparision of Mandelbrot function acceleration using PyTorch 2.0's torch.compile() and Modular's Mojo🔥"><meta property="og:url" content="/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/"><meta property="og:site_name" content="Shashank Prasanna"><meta property="og:title" content="Benchmarking Modular Mojo🔥 and PyTorch torch.compile() on Mandelbrot function"><meta property="og:description" content="Quick comparision of Mandelbrot function acceleration using PyTorch 2.0's torch.compile() and Modular's Mojo🔥"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-05-08T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-08T00:00:00+00:00"><meta property="article:tag" content="Pytorch"><meta property="article:tag" content="Modular"><meta property="article:tag" content="Mojo"><meta property="article:tag" content="Mandelbrot"><meta property="og:image" content="/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/featured-background.png"><meta itemprop=name content="Benchmarking Modular Mojo🔥 and PyTorch torch.compile() on Mandelbrot function"><meta itemprop=description content="Quick comparision of Mandelbrot function acceleration using PyTorch 2.0's torch.compile() and Modular's Mojo🔥"><meta itemprop=datePublished content="2023-05-08T00:00:00+00:00"><meta itemprop=dateModified content="2023-05-08T00:00:00+00:00"><meta itemprop=wordCount content="1913"><meta itemprop=image content="/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/featured-background.png"><meta itemprop=keywords content="Pytorch,Modular,Mojo,Mandelbrot"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/featured-background.png"><meta name=twitter:title content="Benchmarking Modular Mojo🔥 and PyTorch torch.compile() on Mandelbrot function"><meta name=twitter:description content="Quick comparision of Mandelbrot function acceleration using PyTorch 2.0's torch.compile() and Modular's Mojo🔥"><link rel=preload href=/scss/main.min.f6cf8d7c6b0a191be238d38a379647f9caa31754c7ad2ffccce05d6269957aac.css as=style integrity="sha256-9s+NfGsKGRviONOKN5ZH+cqjF1THrS/8zOBdYmmVeqw=" crossorigin=anonymous><link href=/scss/main.min.f6cf8d7c6b0a191be238d38a379647f9caa31754c7ad2ffccce05d6269957aac.css rel=stylesheet integrity="sha256-9s+NfGsKGRviONOKN5ZH+cqjF1THrS/8zOBdYmmVeqw=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-20Q10LSLZ7"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-20Q10LSLZ7")}</script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Shashank Prasanna</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/><span>Home</span></a></li><li class=nav-item><a class=nav-link href=https://medium.com/@shashankprasanna target=_blank rel=noopener><i class='fa-brands fa-medium'></i><span>Medium Blog </span><sup><i class='ps-1 fa-solid fa-up-right-from-square fa-xs' aria-hidden=true></i></sup></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><a href=/><img style=vertical-align:middle src=/featured-background.png alt="shashank prasanna" width=200></a><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><div class=column><div class=column><a href=https://twitter.com/shshnkp target=_blank><font color=gray size=3><i class="fa fab fa-twitter"></i>&nbsp;&nbsp;@shshnkp</font></a></div><div class=column><a href=https://www.youtube.com/@shashank.prasanna target=_blank><font color=gray size=3><i class="fa fab fa-youtube"></i>&nbsp;&nbsp;@shashank.prasanna</font></a></div><div class=column><a href=https://medium.com/@shashankprasanna target=_blank><font color=gray size=3><i class="fa fab fa-medium"></i>&nbsp;@shashankprasanna</font></a></div><div class=column><a href=https://www.linkedin.com/in/shashankprasanna/ target=_blank><font color=gray size=3><i class="fa fab fa-linkedin"></i>&nbsp;&nbsp;shashankprasanna</font></a></div><div class=column><a href=https://github.com/shashankprasanna/ target=_blank><font color=gray size=3><i class="fa fab fa-github"></i>&nbsp;&nbsp;shashankprasanna</font></a></div><div class=column><a href=/shashank_prasanna_resume_2025.pdf target=_blank><font color=gray size=3><i class="fa-solid fa-file"></i>&nbsp;&nbsp;&nbsp;resume</font></a></div></div></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Topics</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/ai-accelerators/ data-taxonomy-term=ai-accelerators><span class=taxonomy-label>Ai Accelerators</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/tags/career/ data-taxonomy-term=career><span class=taxonomy-label>Career</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>Docker</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/genai/ data-taxonomy-term=genai><span class=taxonomy-label>GenAI</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/gpu/ data-taxonomy-term=gpu><span class=taxonomy-label>Gpu</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/tags/mandelbrot/ data-taxonomy-term=mandelbrot><span class=taxonomy-label>Mandelbrot</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/modular/ data-taxonomy-term=modular><span class=taxonomy-label>Modular</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/mojo/ data-taxonomy-term=mojo><span class=taxonomy-label>Mojo</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/openai/ data-taxonomy-term=openai><span class=taxonomy-label>Openai</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/pytorch/ data-taxonomy-term=pytorch><span class=taxonomy-label>Pytorch</span><span class=taxonomy-count>2</span></a></li></ul></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class=td-toc><font color=gray size=6>Sections</font><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#benchmarks-and-caveats>Benchmarks and caveats</a><ul><li></li></ul></li><li><a href=#why-is-pytorch-so-much-faster-than-pythonnumpy-on-cpu>Why is PyTorch so much faster than Python/Numpy on CPU?</a></li><li><a href=#baseline-benchmarking-pythonnumpy>Baseline: Benchmarking Python/Numpy</a></li><li><a href=#benchmarking-mojo-on-the-mojo-playground>Benchmarking Mojo on the Mojo playground</a></li><li><a href=#benchmarking-pytorch-cpu>Benchmarking PyTorch CPU</a></li><li><a href=#benchmarking-pytorch-cpu-with-torchcompile>Benchmarking PyTorch CPU with <code>torch.compile()</code></a></li><li><a href=#benchmarking-pytorch-gpu>Benchmarking PyTorch GPU</a></li><li><a href=#benchmarking-pytorch-gpu-with-torchcompile>Benchmarking PyTorch GPU with <code>torch.compile()</code></a></li><li><a href=#benchmarking-pytorch-apple-m1m2-silicon-with-mps-support>Benchmarking PyTorch Apple M1/M2 Silicon with MPS support</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><font color=black size=5></font>
<a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Benchmarking Modular Mojo🔥 and PyTorch torch.compile() on Mandelbrot function</h1><div class=lead>Quick comparision of Mandelbrot function acceleration using PyTorch 2.0&rsquo;s torch.compile() and Modular&rsquo;s Mojo🔥</div><div class="td-byline mb-4">By <b>Shashank Prasanna</b> |
<time datetime=2023-05-08 class=text-body-secondary>Monday, May 08, 2023</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/pytorch/ data-taxonomy-term=pytorch><span class=taxonomy-label>Pytorch</span></a></li><li><a class=taxonomy-term href=/tags/modular/ data-taxonomy-term=modular><span class=taxonomy-label>Modular</span></a></li><li><a class=taxonomy-term href=/tags/mojo/ data-taxonomy-term=mojo><span class=taxonomy-label>Mojo</span></a></li><li><a class=taxonomy-term href=/tags/mandelbrot/ data-taxonomy-term=mandelbrot><span class=taxonomy-label>Mandelbrot</span></a></li></ul></div></header><p>Last week, Modular - an startup co-founded by Chris Lattner (of LLVM, Swift, MLIR fame), announced a brand new high-performance language called Mojo🔥. Mojo🔥 looks and reads like Python but that&rsquo;s only on the surface, underneath the familiar Python syntax Mojo uses it&rsquo;s own JIT and AOT compilation process to accelerate Python code. Although Mojo doesn&rsquo;t fully support all of Python today, according to Mojo docs, over time Mojo is expected to become a superset of Python.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:410px><img class=card-img-top src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/featured-background_hu_4d82b718f6caf1c3.png width=400 height=285><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text>PyTorch's got some Mojo🔥</p></figcaption></figure>Mojo isn&rsquo;t open-source yet and can only be accessed from the Mojo playground. So I promptly applied and got access to Mojo Playground a couple of days after the accouncement on May 3rd. First thing I wanted to do was to compare Mojo&rsquo;s performance to PyTorch. While PyTorch is a popular framework for deep learning, its also a capable replacement for numpy as a high-performance scientific computing library.</p><p>And my favorite feature of PyTorch is the new <code>torch.compile()</code> API introduced in PyTorch 2.0 that can accelerate arbitrary functions (with limitations) written using the PyTorch API. It takes PyTorch highlevel API, optimizes it and generates C++ or GPU code to improve it&rsquo;s performance. I&rsquo;ve discussed <code>torch.compile()</code> in great detail in my blog post, and I highly recommend reading it if you want to learn about how PyTorch compiler does operator fusion and CPU/GPU code-generation:</p><div class="td-card card border me-4"><div class=card-body><h5 class=card-title><i class='fa-brands fa-medium'></i> <a href=https://medium.com/towards-data-science/how-pytorch-2-0-accelerates-deep-learning-with-operator-fusion-and-cpu-gpu-code-generation-35132a85bd26>How Pytorch 2.0 Accelerates Deep Learning with Operator Fusion and CPU/GPU Code-Generation</a></h5><p class=card-text></p></div></div><p>In this blog post I want to discuss relative performance between Mojo🔥 and PyTorch, and I picked the Mandelbrot example that Jeremy Howard (or FastAI fame) demoed during the Modular keynote. I reimplemnted Mojo&rsquo;s Mandelbrot example in PyTorch to compared it&rsquo;s performance with Mojo. Before I get into the code, here are the results.</p><p><strong>Summary: Mojo is fast! and PyTorch is no slouch either!</strong></p><table><thead><tr><th>Language/Framework</th><th>Mandelbrot execution<br>(200 iterations)</th><th>System</th></tr></thead><tbody><tr><td>PyTorch GPU <code>torch.compile()</code></td><td>~165 μs (micro seconds)</td><td>Intel Core i7-9700K CPU @ 3.60GHz + NVIDIA Titan V</td></tr><tr><td>Mojo CPU</td><td>~2.6 ms</td><td>Mojo Playground: Intel Xeon Platinum 8375C CPU @ 2.90GHz</td></tr><tr><td>PyTorch CPU <code>torch.compile()</code></td><td>~9 ms</td><td>Intel Core i7-9700K CPU @ 3.60GHz</td></tr><tr><td>PyTorch GPU</td><td>~15 ms</td><td>Intel Core i7-9700K CPU @ 3.60GHz + NVIDIA Titan V</td></tr><tr><td>PyTorch CPU</td><td>~50 ms</td><td>Intel Core i7-9700K CPU @ 3.60GHz</td></tr><tr><td>PyTorch Apple M2 MPS</td><td>~70 ms</td><td>Macbook Pro M2 Apple Silicon + 30-Core GPU + 16-Core Neural Engine</td></tr><tr><td>Python/numpy</td><td>~152 ms</td><td>Intel Core i7-9700K CPU @ 3.60GHz</td></tr></tbody></table><h4 id=interesting-observations>Interesting observations</h4><ul><li>Mojo is the fastest CPU implementation</li><li>PyTorch GPU with <code>torch.compile()</code> generates a fused cuda kernel making it the fastest on GPU</li><li>PyTorch CPU with <code>torch.compile()</code> which generates fused C++ code is still faster than PyTorch GPU without compilation</li></ul><p>It should come as no surprise that PyTorch generated custom fused kernel for Mandelbrot function running on GPU is indeed faster than Mojo CPU, it&rsquo;s not even a fair comparision. PyTorch CPU is only slightly slower, but makes up for performance with better usability. Mojo is harder to use and I&rsquo;m positive the UX will improve over time.</p><h2 id=benchmarks-and-caveats>Benchmarks and caveats</h2><p><strong>This is not a scientific benchmark test.</strong> This is a rather crude, and hacked-together-in-a-day example that should illustrate the performance differences and coding approaches, so take it with a grain of Sodium Chloride.</p><h4 id=my-naive-testing-methodology>My naive testing methodology:</h4><ul><li>I use Jupyter&rsquo;s native <code>timeit</code> with <code>10</code> repeats to benchmark and report mean and variance.</li><li>For GPU, I call <code>torch.cuda.synchronize()</code> before measurement to ensure that the kernel is fully executed.</li><li>This code example also benchmarks tensors/arrays creation which is in the body of the function, which migh not be a feature that arises in real-world scenarios.</li><li>I don&rsquo;t measure the compilation time for PyTorch 2.0 and that does take a lot of time to generate loop-unrolled C++ code for CPU and NVPTX for GPU.</li></ul><h4 id=hardware-differences>Hardware differences</h4><p>Mojo is not open-source (yet), and the only way to run it is on the early access Mojo Playground which has a different configuration compared to my desktop running PyTorch. For the Apple M2 benchmark I also use a MacBook Pro laptop for M2 testing. Suffice to say, this is not a fair comparison. Hardware details:</p><ul><li>PyTorch on Desktop<ul><li>CPU: Intel Core i7-9700K CPU @ 3.60GHz with 8 cores</li><li>GPU: NVIDIA Titan V</li></ul></li><li>PyTorch on Mac<ul><li>Apple MacBook Pro with M2 Apple Silicon</li></ul></li><li>Mojo🔥 on Mojo Playground<ul><li>Intel Xeon Platinum 8375C CPU @ 2.90GHz with 32 cores</li></ul></li></ul><div class="td-card card border me-4"><div class=card-header><strong>Update (05/09/23):</strong> Chris Lattner pointed out that Mojo doesn&rsquo;t use all 32 cores on the Mojo Playground. That is mindblowing performance on 4 cores! 🤯</div><div class=card-body><h5 class=card-title><img src=chris_tweet.png alt></h5><p class=card-text></p></div></div><h2 id=why-is-pytorch-so-much-faster-than-pythonnumpy-on-cpu>Why is PyTorch so much faster than Python/Numpy on CPU?</h2><p>PyTorch is faster than Python/Numpy because the higher level PyTorch API calls highly optimized C++ routines implemented in the ATen library. These routines are eagerly evaluated, which means that each PyTorch API call is executed immediately which adds some function call overhead with every API call. To address this, PyTorch 2.0 introduced a compilation API called <code>torch.compile()</code> which takes eager PyTorch code, optimizes it and generates C++ code with OpenMP pragmas for parallelization on CPU or generates GPU code using OpenAI Triton. This is similar to what Numba does for Python code, but PyTorch 2.0&rsquo;s <code>torch.compile()</code> is much more powerful because it can fuse multiple PyTorch API calls into a single kernel, which reduces function call overhead and improves performance.</p><p>I&rsquo;ve discussed this in detail in my PyTorch 2.0 blog post, but here is a screenshot of what the automatically generated fused kernels for C++ for CPU and OpenAI Triton for GPU look like for Mandelbrot function</p><div class="alert alert-primary" role=alert><i class='fa-brands fa-medium'></i>
<a href=https://medium.com/towards-data-science/how-pytorch-2-0-accelerates-deep-learning-with-operator-fusion-and-cpu-gpu-code-generation-35132a85bd26>How Pytorch 2.0 Accelerates Deep Learning with Operator Fusion and CPU/GPU Code-Generation</a></div><div class="td-card-group card-group p-0 mb-4"><div class="td-card card border me-4"><div class=card-header>Autogenerated C++ code for Mandelbrot function with <code>torch.compile()</code></div><div class=card-body><h5 class=card-title><a href=mandelbrot_cpp_fused.png><img src=mandelbrot_cpp_fused.png alt></a></h5><p class=card-text></p></div><div class=card-footer>Click to zoom</div></div><div class="td-card card border me-4"><div class=card-header>Autogenerated OpenAI Triton code for Mandelbrot function with <code>torch.compile()</code></div><div class=card-body><h5 class=card-title><a href=mandelbrot_gpu_fused.png><img src=mandelbrot_gpu_fused.png alt></a></h5><p class=card-text></p></div><div class=card-footer>Click to zoom</div></div></div><h2 id=baseline-benchmarking-pythonnumpy>Baseline: Benchmarking Python/Numpy</h2><p>Let&rsquo;s start with a baseline. Here&rsquo;s the Python/Numpy implementation of Mandelbrot function. I&rsquo;ve also included a function to plot the Mandelbrot set using matplotlib. We&rsquo;ll later modify this function to use PyTorch.</p><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>numpy</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>np</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>torch</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>matplotlib.pyplot</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>plt</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>matplotlib.colors</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>colors</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>warnings</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mandelbrot_numpy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>max_iter</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Define the boundaries of the complex plane</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>450</span>
</span></span><span style=display:flex><span>    <span style=color:#000>yn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>375</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xmin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2.25</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xmax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0.75</span>
</span></span><span style=display:flex><span>    <span style=color:#000>ymin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1.25</span>
</span></span><span style=display:flex><span>    <span style=color:#000>ymax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1.25</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Create the grid of complex numbers</span>
</span></span><span style=display:flex><span>    <span style=color:#000>x_values</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linspace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xmin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xmax</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xn</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dtype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>float64</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>y_values</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linspace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ymin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ymax</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yn</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dtype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>float64</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>iy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>meshgrid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x_values</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_values</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>indexing</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;xy&#39;</span><span style=color:#000;font-weight:700>)</span> 
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>copy</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>iy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>copy</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>mask</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>zeros_like</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>max_iter</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>x_prev</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>x</span>
</span></span><span style=display:flex><span>        <span style=color:#000>y_prev</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>y</span>
</span></span><span style=display:flex><span>        <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>x_prev</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>y_prev</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>rx</span>
</span></span><span style=display:flex><span>        <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>x_prev</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>y_prev</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>iy</span>
</span></span><span style=display:flex><span>        <span style=color:#000>inside</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sqrt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>        <span style=color:#000>mask</span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#000>inside</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>mask</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>make_plot_python</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>450</span>
</span></span><span style=display:flex><span>    <span style=color:#000>yn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>375</span>
</span></span><span style=display:flex><span>    <span style=color:#000>dpi</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>width</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>    <span style=color:#000>height</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>yn</span> <span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#000>xn</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>fig</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>figure</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>width</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>height</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>dpi</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>dpi</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>ax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>fig</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_axes</span><span style=color:#000;font-weight:700>([</span><span style=color:#0000cf;font-weight:700>0.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>frame_on</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>False</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>aspect</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>light</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>colors</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LightSource</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>315</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>image</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>light</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>shade</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cm</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>hot</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>colors</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PowerNorm</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>blend_mode</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;hsv&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>vert_exag</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1.5</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>imshow</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>image</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>axis</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;off&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>show</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong>
With a baseline established let&rsquo;s compare the performance of PyTorch and Mojo.
<img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandel_numpy.png alt></p><h2 id=benchmarking-mojo-on-the-mojo-playground>Benchmarking Mojo on the Mojo playground</h2><p>This comparision is a bit unfair because Mojo🔥 playground has a 32 core Xeon CPU, but I only have a modest 4 year old 8 core desktop CPU. The clock frequency, memory bandwidth and cache sizes and number of cores are all different, but I can&rsquo;t install PyTorch on Mojo playground so this is the best I can do for comparision for now.</p><p>At the bottom of this notebook, I add these few lines of code to measure the execution time of the mandelbrot function.</p><p><img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mojo_playground.png alt></p><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>Time</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>now</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>let</span> <span style=color:#000>eval_begin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>now</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>let</span> <span style=color:#000>mandelbrot_set</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>compute_mandelbrot_simd</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>let</span> <span style=color:#000>eval_end</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>now</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>let</span> <span style=color:#000>execution_time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>eval_end</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>eval_begin</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;execution_time:&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>F64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>execution_time</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>1000000</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output</strong>
I found it difficult to benchmark Mojo, because Python benchmarking tools don&rsquo;t work very readily. I ran the above code several times to ensure that the results are consistent.
<img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/benchmark_mojo.png alt></p><h2 id=benchmarking-pytorch-cpu>Benchmarking PyTorch CPU</h2><p>To update our mandelbrot function from numpy implementation to PyTorch implementation I made the following small changes</p><ul><li>replace <code>np</code> with <code>torch</code></li><li>add <code>device=device</code> to the tensor creation calls, this allows us to pass the appropriate CPU, GPU or Apple MPS device to PyTorch.</li></ul><p>Updated mandelbrot function:</p><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mandelbrot_pytorch</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>device</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;cpu&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>max_iter</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Define the boundaries of the complex plane</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>450</span>
</span></span><span style=display:flex><span>    <span style=color:#000>yn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>375</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xmin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2.25</span>
</span></span><span style=display:flex><span>    <span style=color:#000>xmax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0.75</span>
</span></span><span style=display:flex><span>    <span style=color:#000>ymin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1.25</span>
</span></span><span style=display:flex><span>    <span style=color:#000>ymax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1.25</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Create the grid of complex numbers</span>
</span></span><span style=display:flex><span>    <span style=color:#000>x_values</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linspace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xmin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xmax</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xn</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>device</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>device</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>y_values</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linspace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ymin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ymax</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yn</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>device</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>device</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>iy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>meshgrid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x_values</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_values</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>indexing</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;xy&#39;</span><span style=color:#000;font-weight:700>)</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>clone</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>iy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>clone</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>mask</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>zeros_like</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>device</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>device</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>max_iter</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>x_prev</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>x</span>
</span></span><span style=display:flex><span>        <span style=color:#000>y_prev</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>y</span>
</span></span><span style=display:flex><span>        <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>x_prev</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>y_prev</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>rx</span>
</span></span><span style=display:flex><span>        <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>x_prev</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>y_prev</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>iy</span>
</span></span><span style=display:flex><span>        <span style=color:#000>inside</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sqrt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>        <span style=color:#000>mask</span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#000>inside</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>mask</span>
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s call our <code>mandelbrot_pytorch</code> function with <code>device='cpu'</code>
<img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandel_pytorch_cpu.png alt></p><h2 id=benchmarking-pytorch-cpu-with-torchcompile>Benchmarking PyTorch CPU with <code>torch.compile()</code></h2><p>You can compile PyTorch functions using <code>torch.compile()</code> and TorchInductor will optimize and generate C++ code with OpenMP pragmas for parallization. This will significantly improve the performance of the function. All of this happens under the hood when you run the code below, but you can pass an additional argument <code>options={'trace.enabled':True}</code> to see the generated code. I discuss this is further detail in my PyTorch 2.0 blog post:<div class="td-card card border me-4"><div class=card-body><h5 class=card-title><i class='fa-brands fa-medium'></i> <a href=https://medium.com/towards-data-science/how-pytorch-2-0-accelerates-deep-learning-with-operator-fusion-and-cpu-gpu-code-generation-35132a85bd26>How Pytorch 2.0 Accelerates Deep Learning with Operator Fusion and CPU/GPU Code-Generation</a></h5><p class=card-text></p></div></div></p><p>Let&rsquo;s compile our mandelbrot function for CPU backend:</p><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>device</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cpu&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>mandelbrot_compiled</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>compile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>mandelbrot_pytorch</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>mandelbrot_set</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mandelbrot_compiled</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>device</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>make_plot_python</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>mandelbrot_set</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>numpy</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output</strong>
<img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandel_pytorch_cpu_compile.png alt></p><p>The generated C++ code looks like this</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:773px><img class=card-img-top src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandelbrot_cpp_fused_hu_21703f859c7f7f3d.png width=763 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text></p></figcaption></figure><h2 id=benchmarking-pytorch-gpu>Benchmarking PyTorch GPU</h2><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>device</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cuda&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>mandelbrot_set</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mandelbrot_pytorch</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>device</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>make_plot_python</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>mandelbrot_set</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cpu</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>numpy</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output</strong>
<img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandel_pytorch_gpu.png alt></p><h2 id=benchmarking-pytorch-gpu-with-torchcompile>Benchmarking PyTorch GPU with <code>torch.compile()</code></h2><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>device</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cuda&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>mandelbrot_compiled</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>torch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>compile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>mandelbrot_pytorch</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>mandelbrot_set</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mandelbrot_compiled</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>device</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>make_plot_python</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>mandelbrot_set</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cpu</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>numpy</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandel_pytorch_gpu_compile.png alt></p><p>The generated OpenAI Triton code which gets compiled to NVPTX for GPUs, looks like this</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:728px><img class=card-img-top src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandelbrot_gpu_fused_hu_93a0afd0252abe53.png width=718 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text></p></figcaption></figure><h2 id=benchmarking-pytorch-apple-m1m2-silicon-with-mps-support>Benchmarking PyTorch Apple M1/M2 Silicon with MPS support</h2><p><img src=/benchmarking-modular-mojo-and-pytorch-torch.compile-on-mandelbrot-function/mandel_pytorch_apple_m2.png alt></p><h2 id=conclusion>Conclusion</h2><p>That&rsquo;s it folks! I hope you enjoyed this quick comparision of PyTorch and Mojo🔥.
Mojo is fast, but doesn&rsquo;t have the same level of usability of PyTorch, but that may just be just a matter of time and community support. PyTorch&rsquo;s one-two punch combo of eager mode with high-level Tensor API and compilation with <code>torch.compile()</code> is a powerful combination today. However, the PyTorch ecosystem is also quite fragmented with multiple code paths for different accelerators: TorchInductor (GPUs, CPUs), XLA (TPU, AWS Tranium/Inferentia), custom bindings/bridges (Intel Habana, MPS), and some accelerators like GPUs implement all paths. This leaves the end user and hardware vendors in a dilemma.</p><p>One of the main benefit of Mojo that I see is the ability to write OpenAI Triton style kernel code in the Python language with fast or faster then C++ performance. This would make supporting custom ops for inference easier. We&rsquo;re certainly living in an exciting times for AI Infra, AI accelerators and AI frameworks. Maybe we&rsquo;re at the cusp of another LLVM moment but for AI.</p><p>If you enjoyed reading this, check out my other blog posts on <a href=https://medium.com/@shashankprasanna>Medium</a> or reach out to me on social media, links are on the homepage. Cheers!</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/how-pytorch-2.0-accelerates-deep-learning-with-operator-fusion-and-cpu/gpu-code-generation/ aria-label="Previous - How Pytorch 2.0 accelerates deep learning with operator fusion and CPU/GPU code-generation" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a href=/why-i-joined-modular-ai/ aria-label="Next - Why I joined Modular AI?" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://twitter.com/shshnkp aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=LinkedIn aria-label=LinkedIn><a target=_blank rel=noopener href=https://www.linkedin.com/in/shashankprasanna/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/shashankprasanna/ aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=YouTube aria-label=YouTube><a target=_blank rel=noopener href=https://www.youtube.com/@shashank.prasanna aria-label=YouTube><i class="fab fa-youtube"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Medium aria-label=Medium><a target=_blank rel=noopener href=https://medium.com/@shashankprasanna aria-label=Medium><i class="fab fa-medium"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Shashank Prasanna</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.b953d3b9ad10abbdb4b7e640819c02d8a1ebc4876dc56f3f655b64485dd773f1.js integrity="sha256-uVPTua0Qq720t+ZAgZwC2KHrxIdtxW8/ZVtkSF3Xc/E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>